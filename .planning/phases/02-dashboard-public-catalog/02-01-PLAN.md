---
phase: 02-dashboard-public-catalog
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - supabase/migrations/018_add_bio_thumbnail_catalog_policy.sql
  - src/app/dashboard/layout.tsx
  - src/app/dashboard/page.tsx
  - src/app/dashboard/services/page.tsx
  - src/app/dashboard/profile/page.tsx
  - src/app/dashboard/settings/page.tsx
  - src/components/layout/Sidebar.tsx
autonomous: true
requirements: [CATL-04, CATL-05]

must_haves:
  truths:
    - "Migration 018 adds bio column to tenants table"
    - "Migration 018 adds thumbnail_url column to gig_listings table"
    - "Migration 018 drops NOT NULL on gig_listings.platform_id"
    - "Migration 018 adds contact_for_pricing boolean to gig_listings"
    - "Migration 018 creates anon SELECT policy on gig_listings for verified tenants"
    - "Dashboard sidebar shows three navigation items: Services, Profile, Settings"
    - "Dashboard routes /dashboard/services, /dashboard/profile, /dashboard/settings all render without errors"
    - "react-markdown is installed and importable"
  artifacts:
    - path: "supabase/migrations/018_add_bio_thumbnail_catalog_policy.sql"
      provides: "Schema additions for Phase 2"
      contains: "ALTER TABLE tenants ADD COLUMN bio"
    - path: "src/app/dashboard/services/page.tsx"
      provides: "Services route placeholder"
    - path: "src/app/dashboard/profile/page.tsx"
      provides: "Profile route placeholder"
    - path: "src/app/dashboard/settings/page.tsx"
      provides: "Settings route placeholder"
  key_links:
    - from: "src/components/layout/Sidebar.tsx"
      to: "/dashboard/services, /dashboard/profile, /dashboard/settings"
      via: "navigation array with href links"
      pattern: "href.*dashboard/(services|profile|settings)"
---

<objective>
Create database migration 018 (bio, thumbnail_url, platform_id nullable, contact_for_pricing, anon catalog RLS policy), install react-markdown, expand dashboard sidebar to three sections (Services, Profile, Settings), and scaffold the three dashboard sub-routes with placeholder content.

Purpose: This is the foundation for all Phase 2 work. Migration 018 unblocks the profile form (bio column), service thumbnails (thumbnail_url column), dashboard service creation (platform_id nullable), and the public catalog (anon RLS policy). The sidebar and route scaffolding establishes the dashboard navigation structure that Plans 02 and 03 build on.

Output: Migration SQL file, updated Sidebar component, three dashboard route pages (placeholder), react-markdown installed.
</objective>

<execution_context>
@/Users/alexhale/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alexhale/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-dashboard-public-catalog/02-RESEARCH.md
@.planning/phases/01-multi-tenant-foundation/01-01-SUMMARY.md
@src/components/layout/Sidebar.tsx
@src/app/dashboard/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migration 018 and react-markdown install</name>
  <files>supabase/migrations/018_add_bio_thumbnail_catalog_policy.sql</files>
  <action>
Create migration 018 with all Phase 2 schema changes:

1. Add `bio TEXT DEFAULT ''` to tenants table (PROF-01)
2. Add `thumbnail_url TEXT DEFAULT ''` to gig_listings table (CATL-07)
3. Drop NOT NULL constraint on gig_listings.platform_id (Phase 2 services are platform-agnostic; existing rows keep their FK):
   `ALTER TABLE gig_listings ALTER COLUMN platform_id DROP NOT NULL;`
4. Add `contact_for_pricing BOOLEAN DEFAULT false` to gig_listings (Claude's Discretion: supports quote-based services alongside fixed-price for Phase 3 compatibility)
5. Create anon SELECT policy on gig_listings for the public catalog:
   ```sql
   CREATE POLICY "Public can read services for verified tenants" ON gig_listings
     FOR SELECT TO anon
     USING (
       user_id IN (
         SELECT user_id FROM tenants
         WHERE slug IS NOT NULL AND onboarding_complete = true AND email_verified = true
       )
     );
   ```
   This mirrors the pattern from migration 015 (tenants anon policy).

Also run: `npm install react-markdown` to install the markdown rendering library needed for the public catalog.

Reference migration naming convention from existing files: 015_create_tenants.sql, 016_add_user_id_columns.sql, 017_replace_rls_policies.sql.
  </action>
  <verify>
- File exists at `supabase/migrations/018_add_bio_thumbnail_catalog_policy.sql`
- File contains all 5 ALTER/CREATE statements
- `npm ls react-markdown` shows the package is installed
- `npx tsc --noEmit` passes (no TypeScript errors introduced)
  </verify>
  <done>
Migration 018 SQL file created with bio, thumbnail_url, platform_id nullable, contact_for_pricing, and anon catalog policy. react-markdown installed in package.json.
  </done>
</task>

<task type="auto">
  <name>Task 2: Dashboard sidebar expansion and route scaffolding</name>
  <files>
src/components/layout/Sidebar.tsx
src/app/dashboard/page.tsx
src/app/dashboard/services/page.tsx
src/app/dashboard/profile/page.tsx
src/app/dashboard/settings/page.tsx
  </files>
  <action>
1. **Update Sidebar.tsx navigation array** to include three sections:
   - Services (icon: `LayoutGrid` from lucide-react, href: `/dashboard/services`)
   - Profile (icon: `User` from lucide-react, href: `/dashboard/profile`)
   - Settings (icon: `Settings` from lucide-react, href: `/dashboard/settings`)

   Keep the existing Sidebar structure (collapsible, active state tracking via `usePathname`). Only update the navigation items array. Ensure active state highlights work with the new paths (the existing active detection uses `pathname.startsWith(item.href)` or `pathname === item.href` -- verify which and ensure sub-routes like `/dashboard/services/new` highlight "Services").

2. **Update `/dashboard/page.tsx`** to redirect to `/dashboard/services` using `redirect('/dashboard/services')` from `next/navigation`. The dashboard root should not be a standalone page -- it goes to Services by default.

3. **Create `/dashboard/services/page.tsx`** as a placeholder Server Component:
   - Auth guard: `const { data: { user } } = await supabase.auth.getUser(); if (!user) redirect('/login')`
   - Render Header with title "Services" and description "Manage your service listings"
   - Render an empty state message "You'll be able to manage services here soon" (will be replaced in Plan 02)
   - Import Header and PageContainer from `@/components/layout`

4. **Create `/dashboard/profile/page.tsx`** as a placeholder Server Component:
   - Same auth guard pattern
   - Render Header with title "Profile" and description "Manage your public profile"
   - Placeholder content "Profile editing coming soon"

5. **Create `/dashboard/settings/page.tsx`** as a placeholder Server Component:
   - Same auth guard pattern
   - Render Header with title "Settings" and description "Account settings"
   - Placeholder content "Settings coming soon"

Use the established pattern from the existing `src/app/dashboard/page.tsx` for auth guard and layout imports.
  </action>
  <verify>
- `npm run build` completes without errors
- Sidebar.tsx contains three navigation items with correct hrefs
- `/dashboard` redirects to `/dashboard/services`
- All three routes exist as separate page.tsx files
  </verify>
  <done>
Dashboard sidebar shows Services, Profile, and Settings navigation. Three sub-routes render with placeholder content. Dashboard root redirects to /dashboard/services.
  </done>
</task>

</tasks>

<verification>
- Migration 018 SQL file exists with all 5 schema changes
- react-markdown is in package.json dependencies
- Sidebar has 3 nav items (Services, Profile, Settings) with correct icons and hrefs
- /dashboard redirects to /dashboard/services
- /dashboard/services, /dashboard/profile, /dashboard/settings all render without errors
- `npm run build` succeeds
</verification>

<success_criteria>
Migration 018 is ready for deployment. Dashboard has three-section sidebar navigation. All three sub-routes render placeholder content. react-markdown is available for import.
</success_criteria>

<output>
After completion, create `.planning/phases/02-dashboard-public-catalog/02-01-SUMMARY.md`
</output>
