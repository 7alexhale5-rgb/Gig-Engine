---
phase: 02-dashboard-public-catalog
plan: 04
type: execute
wave: 3
depends_on: [02-02, 02-03]
files_modified:
  - src/app/[slug]/page.tsx
  - src/components/catalog/CatalogHeader.tsx
  - src/components/catalog/ServicePillarSection.tsx
  - src/components/catalog/PublicServiceCard.tsx
  - src/components/catalog/PricingTierDisplay.tsx
  - src/components/catalog/index.ts
autonomous: true
requirements: [PROF-02, CATL-04, CATL-05, CATL-06, CATL-07]

must_haves:
  truths:
    - "A visitor navigates to /{slug} without logging in and sees the freelancer's services grouped by pillar"
    - "Profile identity (avatar, display name, tagline, bio) appears in the catalog header"
    - "Services display thumbnail images when thumbnail_url is set"
    - "Services display Basic/Standard/Premium pricing tiers where defined"
    - "Contact-for-pricing services show 'Contact for pricing' instead of price"
    - "The public catalog is fully usable on mobile (no horizontal scroll, correct touch targets)"
    - "Only active services for verified tenants appear on the public catalog"
    - "Markdown descriptions render with prose styling"
  artifacts:
    - path: "src/app/[slug]/page.tsx"
      provides: "Public catalog page with real service data"
      contains: "groupByPillar"
    - path: "src/components/catalog/CatalogHeader.tsx"
      provides: "Catalog header with avatar, name, tagline, bio"
    - path: "src/components/catalog/ServicePillarSection.tsx"
      provides: "Pillar section with heading and service card grid"
    - path: "src/components/catalog/PublicServiceCard.tsx"
      provides: "Public service card with thumbnail, description, pricing"
    - path: "src/components/catalog/PricingTierDisplay.tsx"
      provides: "Pricing tier display with responsive layout"
    - path: "src/components/catalog/index.ts"
      provides: "Barrel export for catalog components"
  key_links:
    - from: "src/app/[slug]/page.tsx"
      to: "supabase.from('tenants')"
      via: "anon client slug lookup"
      pattern: "eq.*slug.*params.slug"
    - from: "src/app/[slug]/page.tsx"
      to: "supabase.from('gig_listings')"
      via: "anon client service fetch with status=active filter"
      pattern: "eq.*status.*active"
    - from: "src/components/catalog/PublicServiceCard.tsx"
      to: "react-markdown"
      via: "ReactMarkdown component rendering description"
      pattern: "ReactMarkdown"
---

<objective>
Build the public catalog page at /{slug}: replace the placeholder with a full catalog showing the freelancer's profile header and services grouped by pillar, with thumbnail images, markdown descriptions, and pricing tier display. Fully mobile-responsive.

Purpose: This is the primary public-facing output of the product. Visitors navigate to /{slug} to see a freelancer's services without logging in. The catalog must be polished, mobile-usable, and display all service details (thumbnails, descriptions, pricing tiers).

Output: Complete public catalog page with CatalogHeader, ServicePillarSection, PublicServiceCard, and PricingTierDisplay components.
</objective>

<execution_context>
@/Users/alexhale/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alexhale/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-dashboard-public-catalog/02-RESEARCH.md
@.planning/phases/02-dashboard-public-catalog/02-01-SUMMARY.md
@.planning/phases/02-dashboard-public-catalog/02-02-SUMMARY.md
@.planning/phases/02-dashboard-public-catalog/02-03-SUMMARY.md
@src/app/[slug]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Catalog components (Header, ServiceCard, PillarSection, PricingDisplay)</name>
  <files>
src/components/catalog/CatalogHeader.tsx
src/components/catalog/ServicePillarSection.tsx
src/components/catalog/PublicServiceCard.tsx
src/components/catalog/PricingTierDisplay.tsx
src/components/catalog/index.ts
  </files>
  <action>
Create the `src/components/catalog/` directory and all four components. These are Server Components (no 'use client' needed) since they receive data as props from the page.

1. **CatalogHeader.tsx** (Claude's Discretion: avatar + name + tagline; bio below as expandable on mobile):
   - Props: `tenant: { display_name, tagline, bio, avatar_url }`
   - Layout: Centered header section
   - Avatar: 80px circle image (rounded-full), fallback to initials in a colored circle if no avatar_url or image fails
   - Display name: `text-2xl font-bold` below avatar
   - Tagline: `text-lg text-muted-foreground` below name
   - Bio: rendered as markdown using react-markdown with `prose prose-sm max-w-none` classes. On mobile, limit to 3 lines with line-clamp-3 and a "Read more" button that expands (this requires a small client component wrapper for the expand toggle). On desktop (sm+), show full bio.
   - Overall: `text-center` alignment, `py-8` vertical padding

2. **PublicServiceCard.tsx** (follows research Pattern 6):
   - Props: `service: { id, title, description, thumbnail_url, pricing_basic, pricing_standard, pricing_premium, delivery_days_basic, delivery_days_standard, delivery_days_premium, contact_for_pricing }`
   - Card with `rounded-lg border border-border bg-card overflow-hidden`
   - Thumbnail: 16:9 aspect ratio image if thumbnail_url is set. Use `<img>` with `loading="lazy"`, `object-cover`. Hide if no URL.
   - Title: `text-base font-semibold` in card body
   - Description: Render markdown with `react-markdown` using `prose prose-sm max-w-none line-clamp-4` (4-line preview). Do NOT use prose-invert unless the app is dark-mode only -- check existing tailwind.config for dark mode setup and match.
   - Pricing: Use PricingTierDisplay component below description
   - Contact CTA: If contact_for_pricing is true, show "Get in Touch" button (Claude's Discretion: mailto link or a simple "Contact for pricing" label since there's no payment flow yet in Phase 2). Use a subtle button style (variant="outline").
   - Mobile: Card is full-width (within the grid). Touch target minimum 44px on any interactive element.

3. **PricingTierDisplay.tsx**:
   - Props: `service: { pricing_basic, pricing_standard, pricing_premium, delivery_days_basic, delivery_days_standard, delivery_days_premium, contact_for_pricing }`
   - If contact_for_pricing: render "Contact for pricing" text in muted style. Do NOT show any price columns.
   - If only pricing_basic is set (no standard/premium): render a single "From $X" line
   - If multiple tiers defined: render a responsive grid:
     - Desktop (sm+): `grid-cols-3` with Basic/Standard/Premium columns, each showing tier name, price ($X), and delivery time (X days)
     - Mobile: `grid-cols-1` -- tiers stack vertically (prevents horizontal overflow per Pitfall 6)
   - Format prices with dollar sign and comma separators for thousands
   - Use existing `formatCurrency` from `@/lib/utils/formatters` if it exists; otherwise format inline

4. **ServicePillarSection.tsx**:
   - Props: `pillar: { id, name, color, sort_order }`, `services: ServiceWithPillar[]`
   - Render pillar name as section heading: `text-xl font-semibold` with a colored left border accent (using pillar.color as `borderLeftColor` via style prop, 4px border)
   - Below heading: grid of PublicServiceCard components
   - Grid: `grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4`
   - If no services in pillar (shouldn't happen due to grouping), render nothing

5. **index.ts** barrel export:
   - Export CatalogHeader, ServicePillarSection, PublicServiceCard, PricingTierDisplay
  </action>
  <verify>
- `npx tsc --noEmit` passes
- All 4 components + index.ts exist in src/components/catalog/
- PublicServiceCard renders react-markdown for description
- PricingTierDisplay handles single-tier, multi-tier, and contact-for-pricing cases
- No `'use client'` on components that don't need it (except bio expand toggle helper)
  </verify>
  <done>
Four catalog components created: CatalogHeader (avatar + name + tagline + bio), ServicePillarSection (pillar heading + card grid), PublicServiceCard (thumbnail + markdown + pricing), PricingTierDisplay (responsive tier layout). All exported via barrel.
  </done>
</task>

<task type="auto">
  <name>Task 2: Public catalog page with real data</name>
  <files>
src/app/[slug]/page.tsx
  </files>
  <action>
Replace the existing placeholder `[slug]/page.tsx` (from Phase 1 Plan 03) with the full public catalog implementation. Follow research Pattern 5.

1. **Keep existing patterns** from the current file:
   - anon Supabase client (createClient from @supabase/supabase-js, NOT from @/lib/supabase/server)
   - notFound() for unknown slugs
   - Holding state for unverified tenants
   - generateMetadata function

2. **Extend tenant query** to include bio:
   ```
   .select('user_id, display_name, slug, tagline, bio, avatar_url, email_verified, onboarding_complete')
   ```

3. **Add service fetch** after tenant lookup (only for verified tenants):
   ```
   const { data: services } = await supabase
     .from('gig_listings')
     .select('*, service_pillars(id, name, color, sort_order)')
     .eq('user_id', tenant.user_id)
     .eq('status', 'active')
     .order('created_at', { ascending: false })
   ```
   IMPORTANT: Always filter by `status = 'active'` (Pitfall 7: draft services must not appear publicly).

4. **Group services by pillar** using the utility function from research (groupByPillar):
   - Define the function inline or as a module-level helper
   - Groups services by service_pillars.id
   - Sorts pillar groups by sort_order

5. **Render the catalog**:
   - Wrap in `min-h-screen bg-background`
   - Content container: `mx-auto max-w-4xl px-4 py-8 sm:px-6 lg:px-8`
   - CatalogHeader with tenant data
   - Spacer: `mt-10 space-y-12`
   - Map over grouped pillars â†’ ServicePillarSection components
   - If no services: show a friendly "No services yet" message (not an error)

6. **Empty catalog state**:
   - When tenant is verified but has no services, show a centered message: "{display_name} hasn't added any services yet. Check back soon!" -- friendly, not broken-looking.

7. **Mobile responsiveness** (CATL-05):
   - The container uses `px-4` on mobile for safe padding
   - `max-w-4xl` prevents excessive width
   - All child components use responsive grid classes
   - No element should cause horizontal overflow -- verify no `min-w-*` or fixed-width elements without `max-w-full`
  </action>
  <verify>
- `npm run build` completes without errors
- `[slug]/page.tsx` imports from `@/components/catalog`
- Query includes `.eq('status', 'active')` filter
- Query uses anon client (NOT @/lib/supabase/server)
- groupByPillar function exists and sorts by sort_order
- No horizontal scroll on mobile viewport (inspect responsive classes)
  </verify>
  <done>
Public catalog page at /{slug} renders real service data: profile header with avatar/name/tagline/bio, services grouped by pillar with thumbnails, markdown descriptions, and responsive pricing tiers. Mobile-ready. Only active services for verified tenants visible.
  </done>
</task>

</tasks>

<verification>
- Visit /{slug} without logging in: see catalog header with identity fields
- Services grouped by pillar with colored section headings
- Thumbnail images display on services that have them
- Markdown descriptions render with prose styling
- Pricing tiers show Basic/Standard/Premium where defined, stack on mobile
- Contact-for-pricing services show "Contact for pricing" label
- No horizontal scroll at 375px viewport width
- Draft/archived services do not appear
- Unknown slugs return 404
- Unverified tenants show holding state
</verification>

<success_criteria>
A visitor navigates to /{slug} without logging in and sees the freelancer's profile header and services grouped by pillar with pricing tiers, thumbnails, and markdown descriptions. The page is fully usable on mobile.
</success_criteria>

<output>
After completion, create `.planning/phases/02-dashboard-public-catalog/02-04-SUMMARY.md`
</output>
